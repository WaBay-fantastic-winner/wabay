<main>
  <div class='border border-gray-300 boder-solid'>
    <div class="max-w-3xl mx-auto text-xs md:text-base">
      <ul class='grid items-center justify-center h-16 grid-cols-5 '>
        <li class='text-center'><%= link_to "個人頁面",users_profile_path %></li>
        <li class='text-center'><%= link_to "交易紀錄", transactions_path%></li>
        <li class='text-center current-page'><a>追蹤專案</a></li>
        <li class='text-center'><%= link_to "編輯個人資料", edit_user_registration_path %></li>
        <li class='text-center'><a>變更密碼</a></li>
      </ul>
    </div>
  </div>
</main>
<section class='py-5 bg-gray-100 '>
  <h1 class="m-auto mb-4 text-xl text-center"><strong>〘 我 的 追 蹤 清 單 〙</strong></h1>
  <% if @follows.empty? %> 
    <p class="text-center primary-text-color">您目前還沒有任何追蹤的專案唷～</p>
  <% else %>
    <div class="grid max-w-6xl mx-auto md:grid-cols-9">
      <% @follows.each do |follow| %>
        <div class="col-span-3 mx-5 mb-8 FundraisingItem">
          <div class="projects-img-box">
            <a href='projects/<%= follow.followable_id %>', class='projects-link'>
              <% if Project.find_by!(id: follow.followable_id).avatar.attached? %>
                <%= image_tag Project.find_by!(id: follow.followable_id).avatar.variant(resize_to_limit: [1000, 500]), :class=> "object-cover w-full h-full rounded-3xl" %>
              <% else %>
                <% image_tag Faker::Avatar.image %>
              <% end %>
            </a>                    
          </div>
          <div class='mb-4'>
            <h3 class='my-1 text-xl font-semibold hover:text-purple-400'><%= link_to Project.find_by!(id: follow.followable_id).title, project_path(id: follow.followable_id) %></h3>
            <p class='my-1'>提案者 <span class='text-purple-400'><%= Project.find_by!(id: follow.followable_id).organizer %></span></p>
          </div>
          <div>
            <span class='my-1'>NT$  <%= Project.find_by!(id: follow.followable_id).current_total %></span>
          </div>
          <div class="relative h-4 my-1 rounded-md progress-container">
            <span id="progressPercent">0%</span>
            <div class="progress" data-controller='progressBar' data-percentage='<%= ((Project.find_by!(id: follow.followable_id).current_total.to_f / Project.find_by!(id: follow.followable_id).amount_target).round(2) * 100).to_i %>'></div>
          </div> 
          <div class='mt-3'>
            <button class="w-full col-span-1 py-2 text-gray-400 duration-200 border border-gray-400 rounded-lg hover:bg-purple-400 hover:text-white" data-controller='follow' data-action='click->follow#cancelFollow' data-project-id='<%= Project.find_by!(id: follow.followable_id).id %>'>
              <i class="mr-1 fa-solid fa-sheet-plastic"></i>
              取消追蹤
            </button>
          </div> 
        </div>        
      <% end %>
    </div>
  <% end %>  
</section>

